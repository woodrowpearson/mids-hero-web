# Epic 4.2: HP, Endurance, Recharge Displays - Implementation Plan

**Created**: 2025-11-18
**Epic**: 4.2 - HP, Endurance, Recharge Displays
**Status**: Planning
**MidsReborn Analysis**: docs/frontend/analysis/MIDSREBORN-UI-ANALYSIS-epic-4.2.md

---

## Background & Context

**Epic 4.2** continues the Build Totals & Stats Display series (Epic 4), implementing HP, Endurance, Recharge, and Misc stats displays.

**Previous Epic** (4.1):
- ✅ Created StatBar.tsx (reusable horizontal bar component)
- ✅ Created DefensePanel.tsx, ResistancePanel.tsx
- ✅ Created TotalsPanel.tsx (container for all stat panels)
- ✅ Integrated characterStore with `totals: CalculatedTotals | null`
- ✅ Integrated useCalculations hook (POST /api/calculations/totals)
- ✅ Auto-recalculation system in place

**Epic 4.2 builds directly on 4.1** by:
- Reusing StatBar.tsx for HP and Endurance bars
- Extending TotalsPanel.tsx to include new panels
- Reading from existing characterStore.totals (no new state needed)
- No new API endpoints (backend already returns hp/endurance/recharge)

**MidsReborn Reference**: docs/frontend/analysis/MIDSREBORN-UI-ANALYSIS-epic-4.2.md
- Analyzed frmTotals.cs and frmTotalsV2.cs
- Extracted visual design patterns (colors, gradients, layouts)
- Identified 4 display components: HP, Endurance, Recharge, Misc

**Screenshots**:
- shared/user/midsreborn-screenshots/view-total-window.png
- shared/user/midsreborn-screenshots/total-screen-1.png

---

## Objectives

From docs/frontend/epic-breakdown.md:

1. **Create HP & regen display** - Max HP, Regen %, Absorb
2. **Create endurance & recovery display** - Max End, Recovery/s, Usage/s
3. **Create recharge (haste) display** - Global recharge %
4. **Create accuracy, tohit, damage displays** - Misc stats panel

**Success Criteria**:
- All stats calculate correctly via backend
- Panels display values clearly
- Updates happen automatically on build changes
- Visual matches MidsReborn functional layout

---

## Component Specifications

### 1. HPPanel Component

**File**: `frontend/src/components/stats/HPPanel.tsx`

**Purpose**: Display HP-related stats with visual bars

**Props**:
```typescript
interface HPPanelProps {
  hp: {
    max: number;
    regen_percent: number;
    regen_per_second: number;
    absorb?: number;
  } | null;
  archetype?: {
    maxHP?: number;
    regenCap?: number;
  } | null;
  isCalculating?: boolean;
}
```

**Layout**:
```tsx
<div className="space-y-2">
  <h3 className="text-lg font-semibold">Health</h3>

  <StatBar
    label="Max HP"
    value={hp.max}
    cap={archetype.maxHP || 2409} // Tanker cap
    colorTheme="hp"
    format="number" // No % sign
  />

  <StatBar
    label="Regeneration"
    value={hp.regen_percent}
    cap={archetype.regenCap || 300} // 300% soft cap
    colorTheme="hp"
    format="percent" // Shows "140.0%"
    showSubValue={`${hp.regen_per_second.toFixed(1)}/s`}
  />

  {hp.absorb && hp.absorb > 0 && (
    <StatBar
      label="Absorb"
      value={hp.absorb}
      colorTheme="hp-absorb" // Light green/cyan
      format="number"
    />
  )}
</div>
```

**Color Theme** (extend StatBar):
- Base: `bg-gradient-to-r from-green-500 to-green-700`
- Cap indicator: Yellow border at soft cap
- Absorb: `bg-gradient-to-r from-cyan-400 to-cyan-600`

**Tests**:
```typescript
describe('HPPanel', () => {
  it('renders max HP correctly', () => {});
  it('renders regeneration with percentage and per-second', () => {});
  it('renders absorb only when > 0', () => {});
  it('shows loading state', () => {});
  it('applies archetype caps', () => {});
});
```

---

### 2. EndurancePanel Component

**File**: `frontend/src/components/stats/EndurancePanel.tsx`

**Purpose**: Display Endurance-related stats with visual bars

**Props**:
```typescript
interface EndurancePanelProps {
  endurance: {
    max: number;
    recovery_per_second: number;
    usage_per_second: number;
  } | null;
  archetype?: {
    maxEndurance?: number;
    recoveryCap?: number;
  } | null;
  isCalculating?: boolean;
}
```

**Layout**:
```tsx
<div className="space-y-2">
  <h3 className="text-lg font-semibold">Endurance</h3>

  <StatBar
    label="Max End"
    value={endurance.max}
    cap={archetype.maxEndurance || 100} // Base is 100
    colorTheme="endurance"
    format="number"
  />

  <StatBar
    label="End Rec"
    value={endurance.recovery_per_second}
    cap={archetype.recoveryCap || 10} // Visual cap for bar width
    colorTheme="endurance"
    format="decimal" // Shows "2.08/s"
    suffix="/s"
  />

  <StatBar
    label="End Use"
    value={endurance.usage_per_second}
    cap={10} // Visual cap
    colorTheme="endurance-usage"
    format="decimal"
    suffix="/s"
    allowNegative={false} // Usage is always >= 0
  />
</div>
```

**Color Theme**:
- Base: `bg-gradient-to-r from-blue-500 to-blue-700`
- Usage: `bg-gradient-to-r from-red-500 to-red-700` (negative stat)

**Tests**:
```typescript
describe('EndurancePanel', () => {
  it('renders max endurance correctly', () => {});
  it('renders recovery with /s suffix', () => {});
  it('renders usage with /s suffix', () => {});
  it('shows loading state', () => {});
  it('handles zero usage', () => {});
});
```

---

### 3. RechargePanel Component

**File**: `frontend/src/components/stats/RechargePanel.tsx`

**Purpose**: Display global recharge % (from set bonuses, IOs)

**Props**:
```typescript
interface RechargePanelProps {
  recharge: {
    global_percent: number;
  } | null;
  isCalculating?: boolean;
}
```

**Layout**:
```tsx
<div className="space-y-2">
  <h3 className="text-lg font-semibold">Recharge</h3>

  <StatBar
    label="Global Recharge"
    value={recharge.global_percent}
    cap={200} // Visual cap (no hard cap in game)
    colorTheme="recharge"
    format="percent-offset" // Shows "+125.0%" or "0.0%"
    showMilestone={70} // Highlight perma-Hasten threshold
  />

  {/* Optional: Milestone indicators */}
  {recharge.global_percent >= 70 && (
    <div className="text-sm text-green-500">
      ✓ Perma-Hasten achieved (+70% threshold)
    </div>
  )}
</div>
```

**Color Theme**:
- Base: `bg-gradient-to-r from-orange-500 to-orange-700`
- Milestone: Green highlight at +70%

**Tests**:
```typescript
describe('RechargePanel', () => {
  it('renders global recharge correctly', () => {});
  it('formats as offset percentage (+X%)', () => {});
  it('shows perma-Hasten milestone at +70%', () => {});
  it('handles zero recharge', () => {});
  it('shows loading state', () => {});
});
```

---

### 4. MiscStatsPanel Component

**File**: `frontend/src/components/stats/MiscStatsPanel.tsx`

**Purpose**: Display miscellaneous stats (Accuracy, ToHit, Damage)

**Props**:
```typescript
interface MiscStatsPanelProps {
  misc: {
    accuracy: number;
    tohit: number;
    damage: number;
  } | null;
  isCalculating?: boolean;
}
```

**Layout** (Simple list, no bars):
```tsx
<div className="space-y-2">
  <h3 className="text-lg font-semibold">Misc Effects</h3>

  <div className="grid grid-cols-2 gap-4 text-sm">
    <div className="flex justify-between">
      <span className="text-gray-400">Accuracy:</span>
      <span className="font-semibold text-white">
        {misc.accuracy > 0 ? '+' : ''}{misc.accuracy.toFixed(1)}%
      </span>
    </div>

    <div className="flex justify-between">
      <span className="text-gray-400">ToHit:</span>
      <span className="font-semibold text-white">
        {misc.tohit > 0 ? '+' : ''}{misc.tohit.toFixed(1)}%
      </span>
    </div>

    <div className="flex justify-between">
      <span className="text-gray-400">Damage:</span>
      <span className="font-semibold text-white">
        {misc.damage > 0 ? '+' : ''}{misc.damage.toFixed(1)}%
      </span>
    </div>
  </div>
</div>
```

**No bars needed** - Just text display

**Tests**:
```typescript
describe('MiscStatsPanel', () => {
  it('renders accuracy correctly', () => {});
  it('renders tohit correctly', () => {});
  it('renders damage correctly', () => {});
  it('formats positive values with + sign', () => {});
  it('formats negative values correctly', () => {});
  it('shows loading state', () => {});
});
```

---

### 5. Extend StatBar Component (from Epic 4.1)

**File**: `frontend/src/components/stats/StatBar.tsx`

**New Props** (add to existing):
```typescript
interface StatBarProps {
  // ... existing props

  // NEW: Additional formatting options
  format?: 'percent' | 'number' | 'decimal' | 'percent-offset';
  suffix?: string; // e.g., "/s"
  showSubValue?: string; // e.g., "2.8/s" below main value
  allowNegative?: boolean; // Default true
  showMilestone?: number; // Highlight at specific value

  // NEW: Color themes
  colorTheme?: 'defense' | 'resistance' | 'hp' | 'hp-absorb' |
               'endurance' | 'endurance-usage' | 'recharge';
}
```

**Format Types**:
- `percent`: "45.0%" (Epic 4.1 default)
- `number`: "1205" (whole number)
- `decimal`: "2.08" (1-2 decimals)
- `percent-offset`: "+125.0%" or "0.0%" (show + for positive)

**Color Theme Mapping**:
```typescript
const colorThemes = {
  defense: 'from-purple-500 to-purple-700',
  resistance: 'from-cyan-500 to-cyan-700',
  hp: 'from-green-500 to-green-700',
  'hp-absorb': 'from-cyan-400 to-cyan-600',
  endurance: 'from-blue-500 to-blue-700',
  'endurance-usage': 'from-red-500 to-red-700',
  recharge: 'from-orange-500 to-orange-700',
};
```

**Tests** (add to existing):
```typescript
describe('StatBar - Epic 4.2 enhancements', () => {
  it('formats numbers without % sign', () => {});
  it('formats decimals with 1-2 places', () => {});
  it('formats offset percentages with + sign', () => {});
  it('shows suffix after value', () => {});
  it('shows sub-value below main value', () => {});
  it('applies hp color theme (green)', () => {});
  it('applies endurance color theme (blue)', () => {});
  it('applies recharge color theme (orange)', () => {});
  it('shows milestone indicator', () => {});
});
```

---

### 6. Extend TotalsPanel Component (from Epic 4.1)

**File**: `frontend/src/components/stats/TotalsPanel.tsx`

**Current Layout** (Epic 4.1):
```tsx
<div className="grid grid-cols-1 md:grid-cols-2 gap-6">
  <DefensePanel defense={totals?.defense} archetype={archetype} />
  <ResistancePanel resistance={totals?.resistance} archetype={archetype} />
</div>
```

**New Layout** (Epic 4.2):
```tsx
<div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
  {/* Epic 4.1 panels */}
  <DefensePanel defense={totals?.defense} archetype={archetype} />
  <ResistancePanel resistance={totals?.resistance} archetype={archetype} />

  {/* Epic 4.2 panels */}
  <HPPanel hp={totals?.hp} archetype={archetype} />
  <EndurancePanel endurance={totals?.endurance} archetype={archetype} />
  <RechargePanel recharge={totals?.recharge} />
  <MiscStatsPanel misc={totals?.misc} />
</div>
```

**Responsive Breakpoints**:
- Mobile (< 768px): 1 column (stacked)
- Tablet (768px - 1024px): 2 columns
- Desktop (>= 1024px): 3 columns

**Tests** (add to existing):
```typescript
describe('TotalsPanel - Epic 4.2', () => {
  it('renders HP panel with totals.hp data', () => {});
  it('renders Endurance panel with totals.endurance data', () => {});
  it('renders Recharge panel with totals.recharge data', () => {});
  it('renders Misc panel with totals.misc data', () => {});
  it('shows loading state for all new panels', () => {});
  it('applies 3-column grid on desktop', () => {});
});
```

---

## TypeScript Types

**File**: `frontend/src/types/totals.types.ts`

**Extend existing CalculatedTotals interface**:

```typescript
// Epic 4.1 (existing)
export interface DefenseStats {
  smashing: number;
  lethal: number;
  fire: number;
  cold: number;
  energy: number;
  negative: number;
  toxic: number;
  psionic: number;
  melee: number;
  ranged: number;
  aoe: number;
}

export interface ResistanceStats {
  smashing: number;
  lethal: number;
  fire: number;
  cold: number;
  energy: number;
  negative: number;
  toxic: number;
  psionic: number;
}

// Epic 4.2 (NEW)
export interface HPStats {
  max: number;
  regen_percent: number;
  regen_per_second: number;
  absorb?: number;
}

export interface EnduranceStats {
  max: number;
  recovery_per_second: number;
  usage_per_second: number;
}

export interface RechargeStats {
  global_percent: number;
}

export interface MiscStats {
  accuracy: number;
  tohit: number;
  damage: number;
}

// Combined interface
export interface CalculatedTotals {
  defense: DefenseStats;
  resistance: ResistanceStats;
  hp: HPStats; // NEW
  endurance: EnduranceStats; // NEW
  recharge: RechargeStats; // NEW
  misc: MiscStats; // NEW
}

// Archetype interface (extend if needed)
export interface Archetype {
  id: number;
  name: string;
  defenseCap: number; // 45% or 50%
  resistanceCap: number; // 75% or 90%
  maxHP?: number; // Archetype-specific max HP
  regenCap?: number; // Regen % cap (usually 300%)
  maxEndurance?: number; // Usually 100, some ATs higher
  recoveryCap?: number; // Recovery cap
}
```

---

## State Management Plan

### TanStack Query (Server State)

**No changes needed** - Epic 4.1 already set this up.

**Endpoint**: `POST /api/calculations/totals`

**Response** (already includes hp/endurance/recharge):
```json
{
  "defense": { ... },
  "resistance": { ... },
  "hp": {
    "max": 1205,
    "regen_percent": 140.0,
    "regen_per_second": 2.8,
    "absorb": 0
  },
  "endurance": {
    "max": 100,
    "recovery_per_second": 2.08,
    "usage_per_second": 0.0
  },
  "recharge": {
    "global_percent": 125.0
  },
  "misc": {
    "accuracy": 15.0,
    "tohit": 10.0,
    "damage": 50.0
  }
}
```

### Zustand (Client State)

**No changes needed** - Epic 4.1 already provides:

```typescript
// characterStore.ts (from Epic 4.1)
interface CharacterState {
  // ... character data

  totals: CalculatedTotals | null; // Includes hp, endurance, recharge
  isCalculating: boolean;

  recalculate: () => Promise<void>; // Already triggers on build changes
}
```

**Epic 4.2 just reads from existing state** - no new state management needed.

---

## API Integration Plan

**Status**: ✅ No new API work needed

**Endpoint**: `POST /api/calculations/totals` (already exists)

**Backend Status** (from Epic 4.1):
- ✅ Endpoint implemented in Epic 1.4
- ✅ Returns CalculatedTotals including hp, endurance, recharge
- ✅ Error handling in place
- ✅ Tests passing

**Frontend Integration** (from Epic 4.1):
- ✅ useCalculations hook implemented
- ✅ Auto-recalculation on build changes
- ✅ Loading states handled
- ✅ Error states with retry

**Epic 4.2 only needs to**:
- Read hp, endurance, recharge, misc from totals response
- Display in new panels
- No new API calls required

---

## Implementation Tasks

### Phase 1: Extend StatBar Component (45 min)

**Task 1.1**: Add new formatting options
- Add `format` prop (percent, number, decimal, percent-offset)
- Add `suffix` prop
- Add `showSubValue` prop
- Add `allowNegative` prop
- Add `showMilestone` prop
- Write tests for each format type

**Task 1.2**: Add new color themes
- Add hp theme (green gradient)
- Add hp-absorb theme (light cyan)
- Add endurance theme (blue gradient)
- Add endurance-usage theme (red gradient)
- Add recharge theme (orange gradient)
- Write tests for each theme

**Acceptance**:
- ✅ All format types work correctly
- ✅ All color themes apply
- ✅ Sub-values display below main value
- ✅ Milestones highlight correctly
- ✅ 10+ tests passing

---

### Phase 2: Create HPPanel Component (30 min)

**Task 2.1**: Build component structure
- Create HPPanel.tsx
- Import StatBar
- Define HPPanelProps interface
- Implement layout with 2-3 bars (Max HP, Regen %, Absorb)
- Apply green color theme
- Handle loading state

**Task 2.2**: Write tests
- Test Max HP display
- Test Regen % with per-second sub-value
- Test Absorb conditional rendering
- Test loading state
- Test archetype caps

**Acceptance**:
- ✅ Component renders all HP stats
- ✅ Green color theme applied
- ✅ Absorb only shows when > 0
- ✅ 5+ tests passing

---

### Phase 3: Create EndurancePanel Component (30 min)

**Task 3.1**: Build component structure
- Create EndurancePanel.tsx
- Define EndurancePanelProps interface
- Implement layout with 3 bars (Max End, Recovery, Usage)
- Apply blue color theme
- Handle loading state

**Task 3.2**: Write tests
- Test Max End display
- Test Recovery with /s suffix
- Test Usage with /s suffix
- Test loading state
- Test zero usage case

**Acceptance**:
- ✅ Component renders all endurance stats
- ✅ Blue color theme applied
- ✅ /s suffixes display correctly
- ✅ 5+ tests passing

---

### Phase 4: Create RechargePanel Component (20 min)

**Task 4.1**: Build component structure
- Create RechargePanel.tsx
- Define RechargePanelProps interface
- Implement layout with single bar (Global Recharge %)
- Apply orange color theme
- Add perma-Hasten milestone indicator

**Task 4.2**: Write tests
- Test global recharge display
- Test offset percentage formatting (+X%)
- Test perma-Hasten milestone at +70%
- Test zero recharge case
- Test loading state

**Acceptance**:
- ✅ Component renders recharge stat
- ✅ Orange color theme applied
- ✅ Milestone indicator shows at +70%
- ✅ 5+ tests passing

---

### Phase 5: Create MiscStatsPanel Component (20 min)

**Task 5.1**: Build component structure
- Create MiscStatsPanel.tsx
- Define MiscStatsPanelProps interface
- Implement simple list layout (no bars)
- Format stats with + sign for positive values
- Handle loading state

**Task 5.2**: Write tests
- Test accuracy display
- Test tohit display
- Test damage display
- Test positive value formatting (+X%)
- Test loading state

**Acceptance**:
- ✅ Component renders all misc stats
- ✅ Positive values show + sign
- ✅ No bars (text only)
- ✅ 5+ tests passing

---

### Phase 6: Extend TotalsPanel Component (15 min)

**Task 6.1**: Update layout
- Add HPPanel to grid
- Add EndurancePanel to grid
- Add RechargePanel to grid
- Add MiscStatsPanel to grid
- Update grid to 3 columns on desktop

**Task 6.2**: Write tests
- Test all 6 panels render
- Test responsive grid (1/2/3 columns)
- Test loading state for new panels
- Test data flow from characterStore

**Acceptance**:
- ✅ All 6 panels display
- ✅ Responsive layout works
- ✅ 4+ tests passing

---

### Phase 7: Integration Testing (30 min)

**Task 7.1**: Create test page
- Add test data with known HP/End/Recharge values
- Mock characterStore.totals with test data
- Render TotalsPanel with all panels

**Task 7.2**: Verify calculations
- Test HP values display correctly
- Test Endurance values display correctly
- Test Recharge values display correctly
- Test Misc values display correctly
- Test loading states
- Test error states
- Test responsive layout

**Acceptance**:
- ✅ All panels display test data correctly
- ✅ Loading states work
- ✅ Error states work
- ✅ Responsive layout works

---

### Phase 8: Visual Verification (30 min)

**Task 8.1**: Compare with MidsReborn
- Load MidsReborn screenshots
- Compare HP panel colors and layout
- Compare Endurance panel colors and layout
- Compare Recharge display format
- Compare Misc stats format

**Task 8.2**: Capture implementation screenshot
- Run dev server
- Navigate to test page with populated data
- Take screenshot of all panels
- Save as docs/frontend/screenshots/implementation-epic-4.2-hp-endurance-recharge.png

**Acceptance**:
- ✅ Visual parity with MidsReborn
- ✅ Color schemes match
- ✅ Formatting matches
- ✅ Screenshot captured

---

## Total Estimated Time: 4-5 hours

- Phase 1: 45 min (extend StatBar)
- Phase 2: 30 min (HPPanel)
- Phase 3: 30 min (EndurancePanel)
- Phase 4: 20 min (RechargePanel)
- Phase 5: 20 min (MiscStatsPanel)
- Phase 6: 15 min (extend TotalsPanel)
- Phase 7: 30 min (integration testing)
- Phase 8: 30 min (visual verification)

**Total**: ~3.5 hours core work + 30 min buffer = 4-5 hours

---

## Acceptance Criteria

### Functional

✅ **HP display works**:
- Max HP displays as whole number
- Regen % displays with 1 decimal
- Regen per-second shows below as sub-value
- Absorb shows only when > 0
- Values update in real-time when build changes

✅ **Endurance display works**:
- Max End displays as whole number
- Recovery/s displays with 1-2 decimals
- Usage/s displays with 1-2 decimals
- Values update in real-time when build changes

✅ **Recharge display works**:
- Global Recharge % displays with 1 decimal
- Formatted with + sign for positive values
- Perma-Hasten milestone indicator shows at +70%
- Values update in real-time when build changes

✅ **Misc stats display works**:
- Accuracy displays with 1 decimal
- ToHit displays with 1 decimal
- Damage displays with 1 decimal
- Positive values show + sign
- Values update in real-time when build changes

✅ **State management works**:
- Reads from existing characterStore.totals (no new state)
- Auto-recalculation triggers work (from Epic 4.1)
- Loading state shows during calculation
- Error state shows on failure with retry button

✅ **API integration works**:
- POST /api/calculations/totals returns all data
- hp, endurance, recharge, misc fields populated
- No new API endpoints needed

### Visual

✅ **Colors match MidsReborn**:
- HP bars: Green gradient
- Endurance bars: Blue gradient
- Recharge bar: Orange gradient
- Absorb: Light cyan gradient
- Usage: Red gradient (negative stat)

✅ **Layout matches MidsReborn**:
- HP section with Max HP + Regen bars
- Endurance section with Max End + Recovery + Usage bars
- Recharge section with single bar
- Misc section with simple list
- Responsive (3 columns desktop, 2 columns tablet, 1 column mobile)

✅ **Typography and formatting**:
- Percentages show 1 decimal place (e.g., "140.0%")
- Decimals show 1-2 decimal places (e.g., "2.08/s")
- Whole numbers (e.g., "1205")
- Positive values show + sign (e.g., "+125.0%")
- Labels left-aligned, values right-aligned

### Technical

✅ **TypeScript strict mode**:
- No `any` types
- All props typed
- All state typed
- All API responses typed

✅ **Test coverage**:
- StatBar extensions: 10+ tests
- HPPanel: 5+ tests
- EndurancePanel: 5+ tests
- RechargePanel: 5+ tests
- MiscStatsPanel: 5+ tests
- TotalsPanel extensions: 4+ tests
- All tests passing

✅ **Code quality**:
- ESLint passing
- Prettier formatting applied
- No console warnings
- Accessible (ARIA labels, keyboard navigation)

✅ **Component reuse**:
- StatBar.tsx reused for HP and Endurance
- TotalsPanel.tsx extended (not replaced)
- characterStore.totals reused (no new state)
- useCalculations hook reused (no new API)

---

## Visual Verification Checklist

After implementation, verify against MidsReborn:

### HP Panel
- [ ] Max HP displays as whole number
- [ ] Regen % displays with "140.0%" format
- [ ] Regen per-second displays below as "2.8/s"
- [ ] Green gradient bar matches MidsReborn
- [ ] Absorb shows only when present

### Endurance Panel
- [ ] Max End displays as whole number
- [ ] Recovery displays as "2.08/s"
- [ ] Usage displays as "0.0/s"
- [ ] Blue gradient bars match MidsReborn
- [ ] Layout matches MidsReborn

### Recharge Panel
- [ ] Global Recharge displays as "+125.0%"
- [ ] Orange gradient bar matches MidsReborn "Haste"
- [ ] Perma-Hasten milestone indicator works

### Misc Stats Panel
- [ ] Accuracy displays as "+15.0%"
- [ ] ToHit displays as "+10.0%"
- [ ] Damage displays as "+50.0%"
- [ ] No bars (text only) matches MidsReborn

### Responsive Layout
- [ ] Desktop (3 columns): All panels visible
- [ ] Tablet (2 columns): Panels stack appropriately
- [ ] Mobile (1 column): Panels stack vertically

---

## Deferred Features

**Epic 4.3** (Visual Aids - Improved):
- Enhanced stat visualizations beyond MidsReborn
- Comparison tooltips (before/after slotting)
- Mini stat cards for quick view
- Collapsible sections
- Stat trend graphs

**Future Enhancements**:
- Detailed per-power HP/End contributions
- Endurance usage calculator (attack chain)
- Recharge breakdown (which sets/IOs contribute)
- Export stats to clipboard

---

## Next Epic Dependencies

**Epic 4.3**: Visual Aids (Improved)

**Prerequisites** (will be met by Epic 4.2):
- ✅ All basic stat panels complete (Defense, Resistance, HP, Endurance, Recharge, Misc)
- ✅ StatBar component fully featured
- ✅ TotalsPanel container established
- ✅ CalculatedTotals integration complete
- ✅ Auto-recalculation system working

**Epic 4.3 will build on Epic 4.2** by:
- Adding enhanced visualizations (better than MidsReborn)
- Adding comparison tooltips
- Adding mini stat cards
- Maintaining all Epic 4.2 displays

---

## Key Design Decisions

### 1. Reuse StatBar for HP and Endurance

**Rationale**: HP and Endurance use same horizontal bar visualization as Defense/Resistance from Epic 4.1. Just need different color themes.

**Impact**: Minimal new code, consistent UX across all stat panels.

**Implementation**: Extend StatBar with new color themes and format options.

### 2. No New API Endpoints

**Rationale**: Backend already returns hp, endurance, recharge in totals response from Epic 4.1.

**Impact**: Zero backend work needed, faster implementation, no API versioning issues.

**Implementation**: Read from characterStore.totals.hp/endurance/recharge.

### 3. Simple List for Misc Stats (No Bars)

**Rationale**: MidsReborn shows Misc Effects as simple text list. Bars would add unnecessary complexity for stats without meaningful caps.

**Impact**: Cleaner UI, faster to implement, matches MidsReborn UX.

**Implementation**: MiscStatsPanel as text-only component.

### 4. Absorb as Conditional Display

**Rationale**: Most builds don't have absorb. Only show when > 0 to avoid clutter.

**Impact**: Cleaner UI for majority of builds, no confusion about zero values.

**Implementation**: Conditional rendering in HPPanel.

### 5. Perma-Hasten Milestone Indicator

**Rationale**: +70% recharge is a common build goal (perma-Hasten). Highlighting this helps builders.

**Impact**: Better UX than MidsReborn, provides meaningful feedback.

**Implementation**: Conditional indicator in RechargePanel at >= 70%.

---

## Summary

Epic 4.2 delivers **HP, Endurance, Recharge, and Misc stats displays** for Mids Hero Web:

**Components Created** (4 new + 1 extended):
- HPPanel - Max HP, Regen %, Absorb (green gradient bars)
- EndurancePanel - Max End, Recovery, Usage (blue gradient bars)
- RechargePanel - Global Recharge % (orange gradient bar)
- MiscStatsPanel - Accuracy, ToHit, Damage (text list)
- StatBar - Extended with new formats and color themes

**Component Reuse** (from Epic 4.1):
- ✅ StatBar.tsx - Reused for all bars
- ✅ TotalsPanel.tsx - Extended to include new panels
- ✅ characterStore.totals - Reused (no new state)
- ✅ useCalculations hook - Reused (no new API)

**State Management**:
- No new Zustand state (reads from characterStore.totals)
- No new TanStack Query hooks (reuses useCalculations)
- Auto-recalculation already works from Epic 4.1

**Visual Design**:
- Green gradients for HP bars
- Blue gradients for Endurance bars
- Orange gradient for Recharge bar
- Simple text list for Misc stats
- Responsive 3-column layout (desktop)

**API Integration**:
- POST /api/calculations/totals (already exists from Epic 4.1)
- No new endpoints needed
- Backend already returns hp, endurance, recharge, misc

This completes the Build Totals & Stats Display epic series foundation. Epic 4.3 will add enhanced visualizations on top of this base.

---

**Status**: ✅ Planning Complete - Ready for Execution
**Components**: 4 new + 1 extended
**Tests**: ~35 tests total
**Estimated Time**: 4-5 hours
**Dependencies**: Epic 4.1 complete ✅
**Next**: Execute implementation → Visual verification → Checkpoint generation
