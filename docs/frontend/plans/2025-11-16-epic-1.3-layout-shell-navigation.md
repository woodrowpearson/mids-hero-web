# Epic 1.3: Layout Shell + Navigation - Implementation Plan

**Date**: 2025-11-16
**Epic**: 1.3 - Layout Shell + Navigation
**Status**: Planning Complete, Ready for Execution
**MidsReborn Analysis**: docs/frontend/analysis/MIDSREBORN-UI-ANALYSIS-epic-1.3.md
**Previous Epic**: PLAN-SUMMARY-epic-1.2.md (State Management Setup - Complete)

---

## Background & Context

### Epic Objectives

From `docs/frontend/epic-breakdown.md`, Epic 1.3 establishes:
1. Main build editor layout structure
2. Column layout system (2-6 columns configurable)
3. Top control panel with character info
4. Routing setup (home, builder, build/:id)

### Previous Epic Context

Epic 1.2 (State Management Setup) provided:
- ✅ TanStack Query for server state
- ✅ Zustand stores (characterStore, uiStore)
- ✅ API client services
- ✅ Custom hooks (useArchetypes, usePowers, useEnhancements)
- ✅ TypeScript types

### MidsReborn Analysis Summary

From `MIDSREBORN-UI-ANALYSIS-epic-1.3.md`:

**Layout Structure**:
- **Top**: 77px fixed header (24px menu + 53px control panel)
- **Left**: ~250px collapsible sidebar (character creation controls)
- **Center**: Scrollable power grid (FlowLayoutPanel, 2-6 columns)

**Key Patterns**:
- Column count: User-configurable 2-6 (default: 3)
- Power grid: 24 max powers per column, 15px h-padding, 25px v-padding
- Control panel: ImageButton controls for navigation/modes
- Separate windows: Totals and Sets (floating, will defer to Epic 4)

**Web Translation**:
- Form → Next.js page
- Panel → div + Tailwind
- TableLayoutPanel → CSS Grid
- FlowLayoutPanel → CSS Grid with auto-flow
- ToolStrip → Fixed header with flex layout

---

## Component Specifications

### 1. BuildLayout Component

**File**: `frontend/components/layout/BuildLayout.tsx`

**Purpose**: Main layout wrapper for build editor with configurable column grid

**Props Interface**:
```typescript
interface BuildLayoutProps {
  children: React.ReactNode;
  columnCount?: number;  // 2-6, defaults to uiStore value
  showSidebar?: boolean; // Optional sidebar visibility
}
```

**Layout Structure**:
```tsx
<div className="flex flex-col h-screen">
  {/* Top Panel - fixed */}
  <TopPanel />

  <div className="flex flex-1 overflow-hidden">
    {/* Optional Left Sidebar - collapsible */}
    {showSidebar && <SidePanel />}

    {/* Main Content Area - scrollable */}
    <main className="flex-1 overflow-y-auto p-6">
      <div className={`grid grid-cols-${columnCount} gap-4`}>
        {children}
      </div>
    </main>
  </div>
</div>
```

**State Management**:
```typescript
// Uses uiStore from Epic 1.2
const { layout } = useUIStore();
const columnCount = layout.columnCount; // 2-6
```

**Responsive Behavior**:
```typescript
// Tailwind breakpoints
const getResponsiveColumns = (userColumnCount: number) => {
  // Mobile: Always 1 column
  'grid-cols-1 md:grid-cols-2 lg:grid-cols-${userColumnCount}'

  // Tablet: Max 3 columns
  // Desktop: Full user control (2-6)
};
```

**Tests** (`__tests__/components/layout/BuildLayout.test.tsx`):
```typescript
describe('BuildLayout', () => {
  it('renders with default column count', () => {
    render(<BuildLayout><div>Child</div></BuildLayout>);
    expect(screen.getByRole('main')).toHaveClass('grid-cols-3');
  });

  it('applies custom column count', () => {
    render(<BuildLayout columnCount={4}><div>Child</div></BuildLayout>);
    expect(screen.getByRole('main')).toHaveClass('grid-cols-4');
  });

  it('shows sidebar when showSidebar is true', () => {
    render(<BuildLayout showSidebar><div>Child</div></BuildLayout>);
    expect(screen.getByRole('complementary')).toBeInTheDocument();
  });

  it('hides sidebar when showSidebar is false', () => {
    render(<BuildLayout showSidebar={false}><div>Child</div></BuildLayout>);
    expect(screen.queryByRole('complementary')).not.toBeInTheDocument();
  });
});
```

---

### 2. TopPanel Component

**File**: `frontend/components/layout/TopPanel.tsx`

**Purpose**: Fixed top header with character info and navigation controls

**Props Interface**:
```typescript
interface TopPanelProps {
  // No props initially - reads from characterStore
}
```

**Layout Structure**:
```tsx
<header className="h-[77px] border-b bg-background sticky top-0 z-50">
  <div className="flex items-center justify-between px-6 h-full">
    {/* Left: Character Info */}
    <div className="flex items-center gap-4">
      <CharacterNameDisplay />
      <ArchetypeDisplay />
      <LevelDisplay />
    </div>

    {/* Center: Primary Actions */}
    <div className="flex items-center gap-2">
      <Button variant="outline" size="sm">New</Button>
      <Button variant="outline" size="sm">Save</Button>
      <Button variant="outline" size="sm">Load</Button>
      <Button variant="outline" size="sm">Export</Button>
    </div>

    {/* Right: View Controls */}
    <div className="flex items-center gap-2">
      <ColumnLayoutSelector />
      <Button variant="ghost" size="icon">⚙️</Button>
    </div>
  </div>
</header>
```

**State Management**:
```typescript
const { name, archetype, level } = useCharacterStore();
```

**MidsReborn Reference**: Implements frmMain top panel (53px control panel + 24px menu bar)

**Tests** (`__tests__/components/layout/TopPanel.test.tsx`):
```typescript
describe('TopPanel', () => {
  it('displays character name', () => {
    const store = useCharacterStore.getState();
    store.setName('Test Hero');
    render(<TopPanel />);
    expect(screen.getByText('Test Hero')).toBeInTheDocument();
  });

  it('displays archetype', () => {
    const store = useCharacterStore.getState();
    store.setArchetype(mockBlaster);
    render(<TopPanel />);
    expect(screen.getByText('Blaster')).toBeInTheDocument();
  });

  it('renders action buttons', () => {
    render(<TopPanel />);
    expect(screen.getByRole('button', { name: /new/i })).toBeInTheDocument();
    expect(screen.getByRole('button', { name: /save/i })).toBeInTheDocument();
    expect(screen.getByRole('button', { name: /load/i })).toBeInTheDocument();
  });

  it('includes column layout selector', () => {
    render(<TopPanel />);
    expect(screen.getByLabelText(/column/i)).toBeInTheDocument();
  });
});
```

---

### 3. SidePanel Component

**File**: `frontend/components/layout/SidePanel.tsx`

**Purpose**: Optional collapsible left sidebar (placeholder for future character creation controls)

**Props Interface**:
```typescript
interface SidePanelProps {
  collapsed?: boolean;
  onToggle?: () => void;
}
```

**Layout Structure**:
```tsx
<aside
  className={cn(
    "border-r bg-muted/10 transition-all",
    collapsed ? "w-0" : "w-[250px]"
  )}
  role="complementary"
>
  {!collapsed && (
    <div className="p-4">
      <h2 className="font-semibold mb-4">Character Creation</h2>
      <p className="text-sm text-muted-foreground">
        Character creation controls will be implemented in Epic 2.
      </p>
    </div>
  )}

  {/* Collapse Toggle Button */}
  <button
    onClick={onToggle}
    className="absolute right-0 top-1/2 -translate-y-1/2 translate-x-1/2"
  >
    {collapsed ? '→' : '←'}
  </button>
</aside>
```

**State Management**:
```typescript
const { layout, toggleSidebar } = useUIStore();
const collapsed = layout.sidebarCollapsed;
```

**MidsReborn Reference**: Implements left panel (~250px) with character controls

**Tests** (`__tests__/components/layout/SidePanel.test.tsx`):
```typescript
describe('SidePanel', () => {
  it('renders with default width when not collapsed', () => {
    render(<SidePanel collapsed={false} />);
    expect(screen.getByRole('complementary')).toHaveClass('w-[250px]');
  });

  it('collapses to zero width when collapsed', () => {
    render(<SidePanel collapsed={true} />);
    expect(screen.getByRole('complementary')).toHaveClass('w-0');
  });

  it('calls onToggle when button clicked', async () => {
    const user = userEvent.setup();
    const onToggle = vi.fn();
    render(<SidePanel onToggle={onToggle} />);

    await user.click(screen.getByRole('button'));
    expect(onToggle).toHaveBeenCalled();
  });

  it('shows placeholder content when expanded', () => {
    render(<SidePanel collapsed={false} />);
    expect(screen.getByText(/character creation/i)).toBeInTheDocument();
  });
});
```

---

### 4. ColumnLayoutSelector Component

**File**: `frontend/components/ui/ColumnLayoutSelector.tsx`

**Purpose**: Toggle between 2-6 columns for power grid display

**Props Interface**:
```typescript
interface ColumnLayoutSelectorProps {
  // No props - controlled by uiStore
}
```

**Layout Structure**:
```tsx
<div className="flex items-center gap-1">
  <span className="text-xs text-muted-foreground mr-2">Columns:</span>

  <ToggleGroup
    type="single"
    value={String(columnCount)}
    onValueChange={(value) => setColumnCount(Number(value))}
  >
    {[2, 3, 4, 5, 6].map(count => (
      <ToggleGroupItem key={count} value={String(count)} size="sm">
        {count}
      </ToggleGroupItem>
    ))}
  </ToggleGroup>
</div>
```

**State Management**:
```typescript
const { layout, setColumnCount } = useUIStore();
const columnCount = layout.columnCount; // 2-6, default 3
```

**MidsReborn Reference**: Implements View menu column selection (View > 2 Col, 3 Col, etc.)

**Tests** (`__tests__/components/ui/ColumnLayoutSelector.test.tsx`):
```typescript
describe('ColumnLayoutSelector', () => {
  it('displays all column options (2-6)', () => {
    render(<ColumnLayoutSelector />);
    [2, 3, 4, 5, 6].forEach(count => {
      expect(screen.getByText(String(count))).toBeInTheDocument();
    });
  });

  it('highlights current column count', () => {
    const store = useUIStore.getState();
    store.setColumnCount(4);
    render(<ColumnLayoutSelector />);

    expect(screen.getByText('4')).toHaveAttribute('data-state', 'on');
  });

  it('updates uiStore when column selected', async () => {
    const user = userEvent.setup();
    render(<ColumnLayoutSelector />);

    await user.click(screen.getByText('5'));
    expect(useUIStore.getState().layout.columnCount).toBe(5);
  });

  it('persists selection to localStorage', async () => {
    const user = userEvent.setup();
    render(<ColumnLayoutSelector />);

    await user.click(screen.getByText('6'));
    const stored = localStorage.getItem('ui-store');
    expect(JSON.parse(stored).layout.columnCount).toBe(6);
  });
});
```

---

### 5. Routing Pages

#### 5A. Home Page

**File**: `frontend/app/page.tsx`

**Purpose**: Landing page with "Create New Build" button

**Implementation**:
```tsx
export default function HomePage() {
  return (
    <div className="flex flex-col items-center justify-center min-h-screen p-8">
      <h1 className="text-4xl font-bold mb-4">Mids Hero Web</h1>
      <p className="text-xl text-muted-foreground mb-8">
        City of Heroes Build Planner
      </p>

      <Link href="/builder">
        <Button size="lg" className="text-lg px-8 py-6">
          Create New Build
        </Button>
      </Link>

      <div className="mt-12 text-center">
        <h2 className="text-2xl font-semibold mb-4">Features</h2>
        <ul className="space-y-2 text-muted-foreground">
          <li>Modern web-based build planner</li>
          <li>Full Issue 12 power data</li>
          <li>Share builds with permalinks</li>
          <li>Mobile-friendly interface</li>
        </ul>
      </div>
    </div>
  );
}
```

**Tests** (`__tests__/app/page.test.tsx`):
```typescript
describe('HomePage', () => {
  it('displays title and description', () => {
    render(<HomePage />);
    expect(screen.getByText('Mids Hero Web')).toBeInTheDocument();
    expect(screen.getByText(/City of Heroes/i)).toBeInTheDocument();
  });

  it('has create build button linking to /builder', () => {
    render(<HomePage />);
    const button = screen.getByRole('link', { name: /create new build/i });
    expect(button).toHaveAttribute('href', '/builder');
  });

  it('displays feature list', () => {
    render(<HomePage />);
    expect(screen.getByText(/web-based build planner/i)).toBeInTheDocument();
  });
});
```

---

#### 5B. Builder Page

**File**: `frontend/app/builder/page.tsx`

**Purpose**: Main build editor page using BuildLayout

**Implementation**:
```tsx
'use client';

import { BuildLayout } from '@/components/layout/BuildLayout';
import { useUIStore } from '@/stores/uiStore';

export default function BuilderPage() {
  const { layout } = useUIStore();

  return (
    <BuildLayout
      columnCount={layout.columnCount}
      showSidebar={!layout.sidebarCollapsed}
    >
      {/* Placeholder: Empty state until Epic 3 (Power Selection) */}
      <div className="col-span-full flex items-center justify-center p-12 border-2 border-dashed rounded-lg">
        <div className="text-center">
          <h2 className="text-2xl font-semibold mb-2">Empty Build</h2>
          <p className="text-muted-foreground">
            Power selection will be implemented in Epic 3.
          </p>
        </div>
      </div>
    </BuildLayout>
  );
}
```

**Tests** (`__tests__/app/builder/page.test.tsx`):
```typescript
describe('BuilderPage', () => {
  it('renders BuildLayout component', () => {
    render(<BuilderPage />);
    expect(screen.getByRole('main')).toBeInTheDocument();
  });

  it('displays empty state message', () => {
    render(<BuilderPage />);
    expect(screen.getByText(/empty build/i)).toBeInTheDocument();
  });

  it('uses column count from uiStore', () => {
    const store = useUIStore.getState();
    store.setColumnCount(5);
    render(<BuilderPage />);

    expect(screen.getByRole('main')).toHaveClass('grid-cols-5');
  });
});
```

---

#### 5C. Build Viewer Page

**File**: `frontend/app/build/[id]/page.tsx`

**Purpose**: Shared build viewer with SSR for rich previews

**Implementation**:
```tsx
import { Metadata } from 'next';
import { notFound } from 'next/navigation';
import { BuildLayout } from '@/components/layout/BuildLayout';

export async function generateMetadata({ params }: { params: { id: string } }): Promise<Metadata> {
  // TODO: Fetch build from backend (Epic 6)
  // For now, return default metadata
  return {
    title: 'Shared Build - Mids Hero Web',
    description: 'View a shared City of Heroes build',
  };
}

export default async function BuildViewerPage({ params }: { params: { id: string } }) {
  // TODO: Fetch build from backend (Epic 6)
  // For now, show placeholder

  return (
    <BuildLayout columnCount={3} showSidebar={false}>
      <div className="col-span-full p-12 text-center">
        <h2 className="text-2xl font-semibold mb-2">Shared Build</h2>
        <p className="text-muted-foreground">
          Build ID: {params.id}
        </p>
        <p className="text-sm text-muted-foreground mt-4">
          Build loading will be implemented in Epic 6.
        </p>
      </div>
    </BuildLayout>
  );
}
```

**Tests** (`__tests__/app/build/[id]/page.test.tsx`):
```typescript
describe('BuildViewerPage', () => {
  it('renders with build ID', async () => {
    const Page = (await import('@/app/build/[id]/page')).default;
    render(<Page params={{ id: 'test-123' }} />);

    expect(screen.getByText(/test-123/i)).toBeInTheDocument();
  });

  it('uses fixed 3-column layout', async () => {
    const Page = (await import('@/app/build/[id]/page')).default;
    render(<Page params={{ id: 'test-123' }} />);

    expect(screen.getByRole('main')).toHaveClass('grid-cols-3');
  });

  it('hides sidebar for shared builds', async () => {
    const Page = (await import('@/app/build/[id]/page')).default;
    render(<Page params={{ id: 'test-123' }} />);

    expect(screen.queryByRole('complementary')).not.toBeInTheDocument();
  });
});
```

---

## State Management Plan

### UIStore Extension

**File**: `frontend/stores/uiStore.ts` (extends Epic 1.2 implementation)

**New State Shape**:
```typescript
interface UIStore {
  // Existing from Epic 1.2
  theme: 'light' | 'dark';

  // NEW for Epic 1.3
  layout: {
    columnCount: number;          // 2-6, default 3
    sidebarCollapsed: boolean;    // Sidebar collapsed state, default false
    topPanelVisible: boolean;     // Always true for v1
  };

  // New Actions
  setColumnCount: (count: number) => void;
  toggleSidebar: () => void;
}
```

**Implementation**:
```typescript
// frontend/stores/uiStore.ts
import { create } from 'zustand';
import { persist } from 'zustand/middleware';

interface UIState {
  theme: 'light' | 'dark';
  layout: {
    columnCount: number;
    sidebarCollapsed: boolean;
    topPanelVisible: boolean;
  };
  setTheme: (theme: 'light' | 'dark') => void;
  setColumnCount: (count: number) => void;
  toggleSidebar: () => void;
}

export const useUIStore = create<UIState>()(
  persist(
    (set) => ({
      theme: 'light',
      layout: {
        columnCount: 3,           // Default: 3 columns (matches MidsReborn)
        sidebarCollapsed: false,  // Default: Sidebar visible
        topPanelVisible: true,    // Always visible in v1
      },

      setTheme: (theme) => set({ theme }),

      setColumnCount: (count) => {
        if (count < 2 || count > 6) return; // Validate range
        set((state) => ({
          layout: { ...state.layout, columnCount: count }
        }));
      },

      toggleSidebar: () => set((state) => ({
        layout: {
          ...state.layout,
          sidebarCollapsed: !state.layout.sidebarCollapsed
        }
      })),
    }),
    {
      name: 'ui-store',
      partialize: (state) => ({
        theme: state.theme,
        layout: state.layout,
      }),
    }
  )
);
```

**Tests** (`__tests__/stores/uiStore.test.ts`):
```typescript
describe('uiStore - Layout Features', () => {
  beforeEach(() => {
    // Reset store
    localStorage.clear();
  });

  it('has default column count of 3', () => {
    const store = useUIStore.getState();
    expect(store.layout.columnCount).toBe(3);
  });

  it('allows setting column count within range', () => {
    const store = useUIStore.getState();
    store.setColumnCount(5);
    expect(store.layout.columnCount).toBe(5);
  });

  it('rejects column count below 2', () => {
    const store = useUIStore.getState();
    store.setColumnCount(1);
    expect(store.layout.columnCount).toBe(3); // Unchanged
  });

  it('rejects column count above 6', () => {
    const store = useUIStore.getState();
    store.setColumnCount(7);
    expect(store.layout.columnCount).toBe(3); // Unchanged
  });

  it('toggles sidebar state', () => {
    const store = useUIStore.getState();
    expect(store.layout.sidebarCollapsed).toBe(false);

    store.toggleSidebar();
    expect(store.layout.sidebarCollapsed).toBe(true);

    store.toggleSidebar();
    expect(store.layout.sidebarCollapsed).toBe(false);
  });

  it('persists layout preferences to localStorage', () => {
    const store = useUIStore.getState();
    store.setColumnCount(4);
    store.toggleSidebar();

    const stored = localStorage.getItem('ui-store');
    const parsed = JSON.parse(stored);
    expect(parsed.layout.columnCount).toBe(4);
    expect(parsed.layout.sidebarCollapsed).toBe(true);
  });
});
```

---

## API Integration Points

**No New Backend Endpoints Required**

Epic 1.3 is purely UI/layout infrastructure. It uses existing state management from Epic 1.2:
- `characterStore` (Zustand) for character state
- `uiStore` (Zustand) for layout preferences
- No backend API calls needed for layout

**Future API Integration** (Epic 6 - Build Persistence):
- `POST /api/builds` - Save build
- `GET /api/builds/:id` - Load shared build
- These will be integrated into BuilderPage and BuildViewerPage later

---

## Visual Design

### Tailwind Configuration

**Custom Theme Colors** (already configured in Epic 1.2):
```javascript
// tailwind.config.ts
theme: {
  extend: {
    colors: {
      hero: '#3b82f6',     // Blue for hero builds
      villain: '#ef4444',  // Red for villain builds
    },
  },
},
```

### Layout Constants

**From MidsReborn Analysis**:
- Top header height: 77px (24px menu + 53px controls)
- Sidebar width: 250px (collapsible)
- Power grid padding: 15px horizontal, 25px vertical
- Max powers per column: 24

**Translated to Tailwind**:
```typescript
const LAYOUT_CONSTANTS = {
  topPanelHeight: 'h-[77px]',
  sidebarWidth: 'w-[250px]',
  powerGridGap: 'gap-4',        // 16px (close to 15px)
  powerGridPadding: 'p-6',      // 24px (close to 25px)
};
```

### Responsive Breakpoints

```typescript
// Mobile: < 640px
'grid-cols-1'                    // Force single column

// Tablet: 640px - 1024px
'md:grid-cols-2 lg:grid-cols-3'  // Max 3 columns

// Desktop: > 1024px
'lg:grid-cols-${columnCount}'    // Full user control (2-6)
```

### shadcn/ui Components Needed

**Already Installed** (Epic 1.2):
- Button
- ToggleGroup (for ColumnLayoutSelector)

**New Components to Install**:
```bash
npx shadcn-ui@latest add toggle-group
```

---

## Implementation Tasks

### Task 1: Update UIStore with Layout State

**Files**:
- `frontend/stores/uiStore.ts`
- `__tests__/stores/uiStore.test.ts`

**Steps**:
1. Add `layout` object to UIStore state
2. Add `setColumnCount` action (validate 2-6 range)
3. Add `toggleSidebar` action
4. Ensure persistence middleware includes layout state
5. Write tests for new actions

**Acceptance Criteria**:
- ✅ Column count defaults to 3
- ✅ Column count validates range (2-6)
- ✅ Sidebar toggle works
- ✅ Layout preferences persist to localStorage
- ✅ All tests passing

---

### Task 2: Create BuildLayout Component

**Files**:
- `frontend/components/layout/BuildLayout.tsx`
- `__tests__/components/layout/BuildLayout.test.tsx`

**Steps**:
1. Create main layout component with flex column structure
2. Implement responsive CSS Grid with dynamic column count
3. Add sidebar slot (conditional rendering)
4. Add main content area (scrollable)
5. Integrate with uiStore for column count
6. Write component tests

**Acceptance Criteria**:
- ✅ Renders TopPanel at top (fixed)
- ✅ Renders optional SidePanel (collapsible)
- ✅ Renders main grid with configurable columns
- ✅ Applies correct Tailwind classes for responsiveness
- ✅ All tests passing

---

### Task 3: Create TopPanel Component

**Files**:
- `frontend/components/layout/TopPanel.tsx`
- `__tests__/components/layout/TopPanel.test.tsx`

**Steps**:
1. Create fixed header component (77px height)
2. Add left section: Character info (name, AT, level)
3. Add center section: Action buttons (New, Save, Load, Export - placeholders)
4. Add right section: ColumnLayoutSelector + settings icon
5. Integrate with characterStore for display
6. Write component tests

**Acceptance Criteria**:
- ✅ Fixed position at top
- ✅ Displays character info from store
- ✅ Renders action buttons (placeholders)
- ✅ Includes ColumnLayoutSelector
- ✅ All tests passing

---

### Task 4: Create SidePanel Component

**Files**:
- `frontend/components/layout/SidePanel.tsx`
- `__tests__/components/layout/SidePanel.test.tsx`

**Steps**:
1. Create collapsible sidebar component (250px width)
2. Add collapse/expand toggle button
3. Add placeholder content for Epic 2
4. Integrate with uiStore for collapsed state
5. Implement smooth transitions
6. Write component tests

**Acceptance Criteria**:
- ✅ Renders at 250px when expanded
- ✅ Collapses to 0px when collapsed
- ✅ Toggle button works
- ✅ Smooth transition animation
- ✅ All tests passing

---

### Task 5: Create ColumnLayoutSelector Component

**Files**:
- `frontend/components/ui/ColumnLayoutSelector.tsx`
- `__tests__/components/ui/ColumnLayoutSelector.test.tsx`

**Steps**:
1. Install shadcn/ui ToggleGroup component
2. Create column selector with options 2-6
3. Integrate with uiStore.setColumnCount
4. Highlight current selection
5. Write component tests

**Acceptance Criteria**:
- ✅ Displays options 2-6
- ✅ Highlights current selection
- ✅ Updates uiStore on click
- ✅ Persists selection
- ✅ All tests passing

---

### Task 6: Create Home Page

**Files**:
- `frontend/app/page.tsx`
- `__tests__/app/page.test.tsx`

**Steps**:
1. Create landing page with hero section
2. Add "Create New Build" button linking to /builder
3. Add feature list
4. Style with Tailwind
5. Write page tests

**Acceptance Criteria**:
- ✅ Displays title and description
- ✅ Button links to /builder
- ✅ Feature list visible
- ✅ All tests passing

---

### Task 7: Create Builder Page

**Files**:
- `frontend/app/builder/page.tsx`
- `__tests__/app/builder/page.test.tsx`

**Steps**:
1. Create client component using BuildLayout
2. Add empty state placeholder
3. Integrate with uiStore for layout config
4. Write page tests

**Acceptance Criteria**:
- ✅ Uses BuildLayout component
- ✅ Displays empty state
- ✅ Respects uiStore column count
- ✅ All tests passing

---

### Task 8: Create Build Viewer Page

**Files**:
- `frontend/app/build/[id]/page.tsx`
- `__tests__/app/build/[id]/page.test.tsx`

**Steps**:
1. Create async server component
2. Add generateMetadata for SSR
3. Add placeholder content
4. Write page tests

**Acceptance Criteria**:
- ✅ Displays build ID from params
- ✅ Uses BuildLayout
- ✅ Hides sidebar for shared builds
- ✅ All tests passing

---

### Task 9: Install shadcn/ui Components

**Command**:
```bash
cd frontend
npx shadcn-ui@latest add toggle-group
```

**Acceptance Criteria**:
- ✅ ToggleGroup component installed
- ✅ No dependency conflicts

---

### Task 10: Run Tests and Fix Issues

**Command**:
```bash
cd frontend
npm test
```

**Acceptance Criteria**:
- ✅ All component tests passing
- ✅ All store tests passing
- ✅ All page tests passing
- ✅ No TypeScript errors
- ✅ No ESLint errors

---

## Acceptance Criteria

### Functional Requirements

✅ **Layout Structure**:
- BuildLayout component renders with configurable columns
- TopPanel fixed at top (77px height)
- Optional SidePanel (250px, collapsible)
- Main grid area scrollable

✅ **Column Configuration**:
- Users can select 2-6 columns
- Default is 3 columns
- Selection persists to localStorage
- Grid reflows on column count change

✅ **Routing**:
- Home page (/) displays landing
- Builder page (/builder) displays editor
- Build viewer (/build/[id]) displays shared builds

✅ **State Management**:
- UIStore extends with layout preferences
- Layout preferences persist across sessions

✅ **Responsive Design**:
- Mobile (<640px): Single column
- Tablet (640-1024px): Max 3 columns
- Desktop (1024+px): Full user control (2-6)

### Visual Verification Checklist

Compare with MidsReborn screenshots:
- [ ] Overall layout structure matches
- [ ] Top panel height proportional (~77px)
- [ ] Sidebar width proportional (~250px)
- [ ] Grid spacing reasonable (15-25px)
- [ ] Column count selector works
- [ ] Empty state looks reasonable

### Technical Requirements

✅ **TypeScript**:
- All components strictly typed
- No `any` types
- Proper interface definitions

✅ **Testing**:
- All components have tests
- All stores have tests
- All pages have tests
- Test coverage >80%

✅ **Code Quality**:
- ESLint passing
- Prettier formatting
- No console errors

---

## Deferred to Future Epics

### Epic 2: Character Creation
- Character creation controls in SidePanel
- Archetype/Origin/Powerset selectors

### Epic 3: Power Selection
- Power display in grid
- Power picking interaction
- Available powers panel

### Epic 4: Build Totals
- Totals panel (floating or embedded)
- Set bonus panel

### Epic 6: Build Persistence
- Actual save/load functionality
- Backend integration for shared builds
- Rich preview metadata

---

## Dependencies

**Epic 1.2 Prerequisites** (All Complete):
- ✅ TanStack Query configured
- ✅ Zustand stores (characterStore, uiStore)
- ✅ API client services
- ✅ TypeScript types

**External Dependencies**:
- ✅ Next.js 14 (already installed)
- ✅ shadcn/ui Button (already installed)
- ⏳ shadcn/ui ToggleGroup (to be installed)
- ✅ Tailwind CSS (already configured)

---

## Risk Assessment

### Low Risk

✅ **Layout Structure**: Straightforward React/CSS Grid implementation
✅ **State Management**: Simple extension of existing uiStore
✅ **Routing**: Standard Next.js App Router patterns

### Medium Risk

⚠️ **Responsive Design**: Ensuring good UX across all screen sizes
  - **Mitigation**: Test on multiple devices, use browser dev tools

⚠️ **Column Grid Reflow**: Dynamic grid-cols-${n} may need custom CSS
  - **Mitigation**: Use Tailwind safelist or custom CSS classes

### Minimal Risk

✅ **Testing**: Component tests are straightforward
✅ **TypeScript**: Types well-defined from Epic 1.2

---

## Next Epic Preview

**Epic 1.4**: API Client Integration

**Will build on Epic 1.3**:
- Use TopPanel buttons to trigger API calls
- Display fetched data in grid
- Handle loading/error states

**Prerequisites from Epic 1.3**:
- ✅ Layout structure established
- ✅ Empty state placeholders
- ✅ State management ready

---

## Summary

Epic 1.3 establishes the foundational layout structure for Mids Hero Web:

**What We're Building**:
1. Configurable column layout system (2-6 columns)
2. Fixed top panel with character info
3. Optional collapsible sidebar
4. Three-page routing structure (Home, Builder, Viewer)

**How It Works**:
- UIStore manages layout preferences (persisted)
- BuildLayout component orchestrates layout
- CSS Grid provides flexible column system
- Responsive breakpoints ensure mobile compatibility

**What's Next**:
- Epic 2: Populate SidePanel with character creation controls
- Epic 3: Populate main grid with power cards
- Epic 4: Add totals and set bonus displays

This plan is ready for execution via superpowers plugin.

---

**Plan Status**: ✅ Complete and ready for execution
**Estimated Implementation Time**: 4-6 hours
**Test Count**: ~35 tests (10 component tests + 10 store tests + 15 integration tests)
